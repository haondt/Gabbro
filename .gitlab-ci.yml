workflow:
  name: Deploy
  rules:
    - if: $CI_PIPELINE_SOURCE == "web" || $CI_COMMIT_BRANCH == "main"
      when: always

stages:
  - generate

build-deployment:
  stage: generate
  script:
    - echo "$INFISICAL_SECRET" > "key.txt"
    - python3 ./scripts/deploy.py
    - tree
    - export ANSIBLE_LOOKUP_INFISICAL_KEY=$INFISICAL_SECRET

